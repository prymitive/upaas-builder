os:
  Ubuntu:
    packages:
      - git-core
      - rake
      - libpq-dev
      - libmysqlclient-dev
      - libsqlite3-dev
      - imagemagick
      - libmagickcore-dev
      - libmagickwand-dev


interpreter:
  type: ruby
  versions:
    - 1.9.3


repository:
  clone: git clone --depth=100 --quiet --branch 2.3-stable git://github.com/redmine/redmine.git %destination%
  update:
    - git reset --hard
    - git pull
  info: git log -n 1
  changelog: git log --no-merges %old%..%new%"


actions:
  setup:
    before: |
      echo "
      production:
        adapter: sqlite3
        database: db/redmine.db
      " > config/database.yml
    main:
      - gem install bundler
      - bundle install --without test development
    after:
      - rake generate_secret_token
      - rake db:migrate
      - REDMINE_LANG=en rake redmine:load_default_data
